<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>king's blog</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="stylesheet" href="/index.css">
    <!--<style type="text/css">
        @font-face {
            font-family: 'FontAwesome';
            src: url('/fontawesome-webfont.eot?v=4.6.3');
            src: url('/fontawesome-webfont.eot?#iefix&v=4.6.3') format('embedded-opentype'), url('/fontawesome-webfont.woff2?v=4.6.3') format('woff2'), url('/fontawesome-webfont.woff?v=4.6.3') format('woff'), url('/fontawesome-webfont.ttf?v=4.6.3') format('truetype'), url('/fontawesome-webfont.svg?v=4.6.3#fontawesomeregular') format('svg');
            font-weight: normal;
            font-style: normal;
        }
        .fa:before {
            font: normal normal normal 25px/1 FontAwesome;
        }
        body {
            margin:0;
        }
        ul {
            margin:0;
            padding:0;
            list-style-type: none;
        }
        .container {
            width:1000px;
            padding:0 15px;
            margin:auto;
        }
        @media screen and (max-width: 1020px){
            .container {
                width:800px;
            }
        }
        .header {
            background-image: url("/top-bg.png");
            background-repeat: repeat-x;
            height:70px;
            padding: 25px;
        }
        .logo {
            height: 70px;
            width:70px;
            border-radius: 50%;
        }
        .nav-list{
            float:right;
            height:30px;
            font-size: 25px;
            padding:20px 0;
        }
        .nav-list li{
            padding: 0 30px;
            float: left;
            line-height: 30px;
        }
        .nav-list a{
            text-decoration: none;
            color: #000;
        }
        .nav-list a:hover{
            color:#fff;
        }
        .nav-list a:before{
            margin-right:5px;
        }
        .home a:before{
            content: '\f015';
        }
        .blog a:before{
            content: '\f0db';
        }
    </style>-->
</head>
<body>
<header class="header">
    <div class="container">
        <img alt="logo" src="/logo.png" class="logo">
        <ul class="nav-list">
            <li class="home"><a title="Home" href="javascript:void(0);" class="fa">Home</a></li>
            <li class="blog"><a title="Blog" href="javascript:void(0);" class="fa">Blog</a></li>
        </ul>
    </div>
</header>
<div class="content container">
    <div class="main">
        <div class="form-line">
            <label for="username" class="form-left">用户名:</label><input type="text" id="username">
        </div>
        <div class="form-line">
            <label for="password" class="form-left">密码:</label><input type="password" id="password">
        </div>
        <div class="form-line">
            <span class="form-left"></span><a href="javascript:void(0);" title="注册" class="registed btn">注册</a>
            <a href="javascript:void(0);" title="登陆" class="login btn">登陆</a>
        </div>
    </div>
</div>
<script type="text/javascript" src="/webtoolkit.md5.js"></script>
<script type="text/javascript">
    var registed = document.getElementsByClassName('registed')[0];
    registed.addEventListener('click', function() {
        var username = document.getElementById('username').value;
        var password = document.getElementById('password').value;
        var data = 'username='+encodeURIComponent(username)+'&password='+MD5(encodeURIComponent(password));
        var xhr = new XMLHttpRequest();
        xhr.open('post', '/registed', true);
        xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        xhr.send(data);
    });

    var login = document.getElementsByClassName('login')[0];
    login.addEventListener('click', function() {
        var username = document.getElementById('username').value;
        var password = document.getElementById('password').value;
        var data = 'username='+encodeURIComponent(username)+'&password='+MD5(encodeURIComponent(password));
        var xhr = new XMLHttpRequest();
        xhr.open('post', '/login', true);
        xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        xhr.send(data);
        xhr.onreadystatechange = function() {
            if(xhr.readyState == 4) {
                if(xhr.status == 200) {
                    var res = JSON.parse(xhr.response);
                    if(res && res.token) {
                        console.log('get token');
                        var exp = new Date();
                        exp.setTime((exp.getTime()+1*24*60*60*1000));
                        document.cookie = 'auth=' + res.token + ';expires=' + exp.toGMTString();

                        var xhr2 = new XMLHttpRequest();
                        xhr2.open('post', '/checkLogin', true);
                        xhr2.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                        xhr2.setRequestHeader('Auth', cookie.getCookie('auth'));
                        xhr2.send(data);
                    }
                }
            }
        };

       /* xhr.open('post', '/checkLogin', true);
        xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        xhr.setRequestHeader('Auth', cookie.getCookie(auth));
        xhr.send(data);
        xhr.onreadystatechange = function() {
            if(xhr.readyState == 4) {
                if(xhr.status == 200) {
                    var res = JSON.parse(xhr.response);
                    if(res && res.token) {
                        var exp = new Date();
                        exp.setTime((exp.getTime()+1*24*60*60*1000));
                        document.cookie = 'token=' + res.token + ';expires=' + exp.toGMTString();
                    }
                }
            }
        }*/
    });
    var cookie = {
        setCookie: function(key, value, exp){
            var str = key + '=' + value;
            if(exp) {
                var d = new Date();
                str += ';expires=' + d.setTime(d.getTime()+exp).toGMTString();
            }
            document.cookie = str;
        },
        getCookie: function(key) {
            reg=new RegExp("(^| )"+key+"=([^;]*)(;|$)");
            return document.cookie.match(reg)[2];
        },
        removeCookie: function(key) {
            cookie.setCookie(key,cookie.getCookie(),-1);
            /* var exp = new Date();
             exp.setTime(exp.getTime() - 1);
             document.cookie = key + '=' + cookie.getCookie(key) + ';expires=' + exp.toGMTString();*/
        }
    };
</script>
</body>
</html>